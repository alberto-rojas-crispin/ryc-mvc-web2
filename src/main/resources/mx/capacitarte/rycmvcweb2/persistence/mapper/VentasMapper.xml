<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="mx.capacitarte.rycmvcweb2.persistence.mapper.VentasMapper">

	<resultMap id="consultarVentasResultMap" type="mx.capacitarte.rycmvcweb2.VO.VentaVO" >
		<result property="numeroFolio" column="FOLIO" />
        <result property="idProducto" column="ID" />
        <result property="cantidad" column="CANTIDAD" />
        <result property="idTipoUnidad" column="TIPO_UNIDAD" />
        <result property="idPrecio" column="ID_PRECIO" />
        <result property="precioTotal" column="PRECIO_TOTAL" />
        <result property="vigencia" column="VIGENCIA" />
        <result property="fechaCreacion" column="FECHA_CREACION" />
         <result property="usuarioCreacion" column="USUARIO_CREACION" />
        <result property="fechaActualizacion" column="FECHA_ACTUALIZACION" />
        <result property="usuarioActualizacion" column="USUARIO_ACTUALIZACION" />
	</resultMap>

	<select id="consultar" resultMap="consultarVentasResultMap">
		
        
               		  SELECT 
					    FTC_FOLIO AS FOLIO,
					    FTN_ID_PRODUCTO AS ID,
					    FTN_CANTIDAD AS CANTIDAD,
					    FTN_ID_TIPO_UNIDAD AS TIPO_UNIDAD,
                        FTN_ID_PRECIO AS ID_PRECIO,
					    PRECIO_TOTAL AS PRECIO_TOTAL,
					    FCB_VIGENCIA AS VIGENCIA,
					    FCD_FEH_CRE AS FECHA_CREACION,
					    FCC_USU_CRE AS USUARIO_CREACION,
					    FCD_FEH_ACT AS FECHA_ACTUALIZACION,
					    FCC_USU_ACT AS USUARIO_ACTUALIZACION
					FROM TT_FARM_VENTAS
						ORDER BY FTC_FOLIO
        
	</select>
	
	<select id="consultarVentasTotales" resultMap="consultarVentasResultMap">
		
        
               		  SELECT 
					    FTC_FOLIO AS FOLIO,
					    FTN_ID_PRODUCTO AS ID,
					    FTN_CANTIDAD AS CANTIDAD,
					    FTN_ID_TIPO_UNIDAD AS TIPO_UNIDAD,
                        FTN_ID_PRECIO AS ID_PRECIO,
					    PRECIO_TOTAL AS PRECIO_TOTAL,
					    FCB_VIGENCIA AS VIGENCIA,
					    FCD_FEH_CRE AS FECHA_CREACION,
					    FCC_USU_CRE AS USUARIO_CREACION,
					    FCD_FEH_ACT AS FECHA_ACTUALIZACION,
					    FCC_USU_ACT AS USUARIO_ACTUALIZACION
					FROM TT_FARM_VENTAS
						ORDER BY FTC_FOLIO
        
	</select>
	
	<select id="consultarVentaPersonalizada" resultMap="consultarVentasResultMap">
	
	SELECT 
					    FTC_FOLIO AS FOLIO,
					    FTN_ID_PRODUCTO AS ID,
					    FTN_CANTIDAD AS CANTIDAD,
					    FTN_ID_TIPO_UNIDAD AS TIPO_UNIDAD,
                        FTN_ID_PRECIO AS ID_PRECIO,
					    PRECIO_TOTAL AS PRECIO_TOTAL,
					    FCB_VIGENCIA AS VIGENCIA,
					    FCD_FEH_CRE AS FECHA_CREACION,
					    FCC_USU_CRE AS USUARIO_CREACION,
					    FCD_FEH_ACT AS FECHA_ACTUALIZACION,
					    FCC_USU_ACT AS USUARIO_ACTUALIZACION
					FROM TT_FARM_VENTAS
                    <where> 
                    <if test="numeroFolio != null">
                    AND FTC_FOLIO = #{numeroFolio} 
                    </if>
                    <if test="idProducto != null">
                    AND FTN_ID_PRODUCTO = #{idProducto} 
                    </if>
                    <if test="vigencia != null">
                    AND FCB_VIGENCIA = #{vigencia}
                    </if>
                    </where>
						ORDER BY FTC_FOLIO, FTN_ID_PRODUCTO
	
	</select>
	
	<insert id="agregarVenta">
	
		    INSERT INTO TT_FARM_VENTAS (
                            FTC_FOLIO,
                            FTN_ID_PRODUCTO,
                            FTN_CANTIDAD ,
                            FTN_ID_TIPO_UNIDAD,
                            FTN_ID_PRECIO,
                            PRECIO_TOTAL,
                            FCB_VIGENCIA,
                            FCD_FEH_CRE,
                            FCC_USU_CRE
                           )
                        VALUES (
                            FARM_VENTAS_SEQ.NEXTVAL,
                            #{idProducto},
                            #{cantidad},
                            #{idTipoUnidad},
                            #{idPrecio},
                            #{precioTotal},
                            #{vigencia},
                            SYSTIMESTAMP,
                            #{usuarioCreacion}
                        )
	
	</insert>
	
	<update id="actualizarVenta">
	
					UPDATE TT_FARM_VENTAS
                        SET
					    FTN_CANTIDAD = #{cantidad},
					    FTN_ID_TIPO_UNIDAD = #{idTipoUnidad},
                        FTN_ID_PRECIO = #{idPrecio},
					    PRECIO_TOTAL = #{precioTotal},
					    FCB_VIGENCIA = #{vigencia},
					    FCD_FEH_ACT = SYSTIMESTAMP,
					    FCC_USU_ACT = #{usuarioActualizacion}
					<where>
						<if test="numeroFolio != null">
						AND FTC_FOLIO = #{numeroFolio}
						</if>
						 
						<if test="idProducto != null">
						AND FTN_ID_PRODUCTO =  #{idProducto} 
						</if>
					</where> 
		
	</update>
	
	<delete id="eliminarVenta">
	
		DELETE FROM TT_FARM_VENTAS WHERE FTC_FOLIO = #{numeroFolio}
		
	</delete>
	

	<select id="consultarFolioGenerado" resultType="int">
		       
		        SELECT MAX (FTC_FOLIO) AS ID_MAXIMO FROM TT_FARM_VENTAS
	
	</select>
	
</mapper>